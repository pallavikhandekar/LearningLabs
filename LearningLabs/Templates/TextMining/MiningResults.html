{% extends "index.html" %}

{% block content %}

{% load staticfiles %}

    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script>
		Array.prototype.contains = function(obj) {
		    var i = this.length;
		    while (i--) {
		        if (this[i][0] == obj) {
		            return true;
		        }
		    }
		    return false;
		}
	    google.load("visualization", "1", {packages:["corechart"]});
	
		var dataChart = [['Words','Frequency']];
		  {% for key, value in data.items %}
		  	dataChart.push(['{{key}}',{{value}}]);
		  {% endfor %}
		  
		 var options = {
		    title: 'Polling Results',
		    selectionMode: 'multiple',
		    hAxis: {title: 'Answer Choice', titleTextStyle: {color: 'red'}}
		  };
		
		//Holds the selected data
		var selectedData = [];
		
		window.onload = function onMiningResultsLoad(){
			drawChart(dataChart);
		}
		//Draw chart from passed data array
		function drawChart(dataForChart) {
		  var data = google.visualization.arrayToDataTable(dataForChart);
		  var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
		    
		  google.visualization.events.addListener(chart, 'select', function () {
		  		//empty on every selection and recreate selected data
		  		selectedData.length = 0;
		  	
				var selection = chart.getSelection();
		        if (selection.length) {
		        	for (i = 0; i < selection.length; i++) { 
						if(selectedData.contains(data.Ad[selection[i].row][0].Pe)==false){
		           			selectedData.push([data.Ad[selection[i].row][0].Pe,parseInt(data.Ad[selection[i].row][1].Pe)]);
		            	}
		            }
		         }
		         //var testData = google.visualization.arrayToDataTable(selectedData);
		         //chart.draw(testData, options);
				  
		  });
		  
		  chart.draw(data, options);
		  
		}
		
		//Combine bars / rename bar 
		function mergeData(){
			var newTitle = document.getElementById('mergeTitle').value;
			var addMergedData = 0;
			
			for (i = 0; i < selectedData.length; i++) { 
				addMergedData  =selectedData[i][1]+addMergedData;
				var j = dataChart.length;
			    while (j--) {
			        if (dataChart[j][0] == selectedData[i][0]) {
			            dataChart.splice(j,1);
			        }
			    }
			}

			 dataChart.push([newTitle,addMergedData]);
			 drawChart(dataChart);
		}
		
    </script>
<div id="page-wrapper">

 	<div class="container-fluid">
 	<div class="row">
    <div id="chart_div" style="width: 70%; height: 500px"></div>
    </div>
  	<div class="row">
  		<div class="col-lg-3">
	        <div class="form-group has-feedback has-feedback-left">
		    <label class="control-label" >New Bar Title:</label>
	    	 <input type="text" id="mergeTitle" placeholder="" class="form-control">
	    	 <i title = "Enter new or merge title" class="glyphicon glyphicon-info-sign form-control-feedback"></i>
			</div>
		</div>
	</div>
	<div class="row">
  		<input class="btn btn-primary" type="submit" value=Update onclick="mergeData();">
  	</div>
  	</div>
  	
  {% endblock %}
